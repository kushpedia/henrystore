{% extends 'partials/base.html' %}
{% load humanize %}
{% load static %}
{% block content %}

<main class="main" id="cart-list">
	<div class="page-header breadcrumb-wrap">
		<div class="container">
			<div class="breadcrumb">
				<a href="{% url 'core:index' %}" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
				<span></span><a href="{% url 'core:product-list' %}">Shop</a> 
				<span></span> Cart
			</div>
		</div>
	</div>
	<div class="container mb-80 mt-50">
		<div class="row">
			<div class="col-lg-8 mb-40">
				<h1 class="heading-2 mb-10">Your Cart</h1>
				<div class="d-flex justify-content-between">
					<h6 class="text-body">There are <span class="text-brand">{{totalcartitems}}</span> products in your cart</h6>
					
				</div>
			</div>
		</div>
		<form action="{% url 'core:save_checkout_info' %}" method="POST">
            {% csrf_token %}
            <div class="row">
                <div class="col-lg-8">
                    <div class="table-responsive shopping-summery">
                        <table class="table table-wishlist">
                            <thead>
                                <tr class="main-heading">
                                    <th scope="col">Product</th>
                                    <th scope="col">Title & Details</th>
                                    <th scope="col">Unit Price</th>
                                    <th scope="col" class="text-center">Quantity</th>
                                    <th scope="col">Subtotal</th>
                                    <th scope="col" class="">Refresh</th>
                                    <th scope="col" class="end">Remove</th>
                                </tr>
                            </thead>
                            <tbody>                               
{% for product_id, item in cart_data.items %}
<tr class="pt-30">
    <td class="image product-thumbnail pt-40">
        <img src="{{ item.image }}" alt="{{ item.original_title|default:item.title }}" 
            style="width: 100px; height: auto; border-radius: 8px; border: 1px solid #eee;">
    </td>
    <td class="product-des product-name">
        <!-- Product Title (without variation details) -->
        <h6 class="mb-2">
            <a class="product-name mb-10 text-heading" href="{% url 'core:product-detail' item.pid %}">
                {{ item.original_title|default:item.title|truncatechars:30 }}
            </a>
        </h6>
        
        <!-- Variation Details - ALWAYS SHOW EVEN IF EMPTY FOR DEBUG -->
        <div class="variation-details mb-2 p-2" style="background: #f8f9fa; border-radius: 6px; border-left: 3px solid #3BB77E;">
            <div class="row">
                {% if item.color and item.color != "none" and item.color != "" %}
                <div class="col-12 mb-1">
                    <span class="text-muted" style="font-size: 13px;">
                        <i class="fi-rs-palette me-1"></i> 
                        <strong>Color:</strong> 
                        <span class="ms-1">{{ item.color }}</span>
                        <div class="d-inline-block ms-2" style="
                            width: 26px;
                            height: 26px;
                            border-radius: 20%;
                            background-color: {% if item.color == 'Black' %}#000000{% elif item.color == 'Blue' %}#0000FF{% elif item.color == 'Brown' %}#A52A2A{% elif item.color == 'Red' %}#FF0000{% elif item.color == 'Green' %}#00FF00{% elif item.color == 'White' %}#FFFFFF{% elif item.color == 'Gray' %}#808080{% elif item.color == 'Cyan' %}#00FFFF{% elif item.color == 'Yellow' %}#FFFF00 {% else %}#CCCCCC{% endif %};
                            border: 1px solid #ddd;
                            vertical-align: middle;
                        "></div>
                    </span>
                </div>
                {% endif %}
                
                {% if item.size and item.size != "none" and item.size != "" %}
                <div class="col-12">
                    <span class="text-muted" style="font-size: 13px;">
                        <i class="fi-rs-ruler me-1"></i> 
                        <strong>Size:</strong> 
                        <span class="ms-1">{{ item.size }}</span>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- SKU -->
        <div class="mt-2">
            <small class="text-muted">
                <i class="fi-rs-barcode me-1"></i>
                SKU: {{ item.sku }}
            </small>
        </div>
    </td>
    <td class="price" data-title="UnitPrice">
        <h4 class="text-body">Ksh {{ item.price|floatformat:0|intcomma }}</h4>
    </td>
    <td class="text-center detail-info" data-title="Quantity">
        <div class="d-flex align-items-center justify-content-center">
            <div class="input-group" style="width: 120px;">
                <input type="number" 
                        class="form-control product-qty-{{ product_id }}" 
                        value="{{ item.qty }}" 
                        min="1" 
                        style="text-align: center;">
                
            </div>
        </div>
    </td>
    <td class="price" data-title="Subtotal">
        <h4 class="text-brand">Ksh {% widthratio item.price 1 item.qty %} </h4>
    </td>
    <td class="action text-center" data-title="Refresh">
        <button class="btn btn-outline-secondary update-product" 
                        type="button" 
                        data-product="{{ product_id }}">
                    <i class="fi-rs-refresh"></i>
        </button>
    </td>
    <td class="action text-center" data-title="Remove">
        <a style="border: none; background: none;"  
            class="text-body delete-product" 
            data-product="{{ product_id }}">
            <i class="fi-rs-trash"></i>
        </a>
    </td>
</tr>
{% endfor %}
                            </tbody>
                        </table>

                        <div class="row mt-4">
                            <h4 class="mb-30">Bio Data</h4>
                            <div class="row">
                                <div class="form-group col-lg-12">
                                    <label for="">Full Name</label>
                                    <input type="text" required="" name="full_name" value="{{request.user.username|title}}" placeholder="Full Name">
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="">Email</label>
                                    <input type="text" required="" name="email"  placeholder="mobile *" value="{{request.user.email}}">
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="">Mobile</label>
                                    <input type="text" name="mobile" value="{{request.user.profile.phone}}" required="" placeholder="Address *">
                                </div>
                            </div>
                            <h4 class="mb-30">Shipping Details</h4>
                            <div class="row">
                                <div class="form-group col-lg-6">
                                    <label for="">Address</label>
                                    <input type="text" name="address" value="" placeholder="Address" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="">City</label>
                                    <input type="text" name="city"  placeholder="City *" value="" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="">State</label>
                                    <input type="text" name="state" value="" placeholder="State *" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="">Country</label>
                                    <input type="text" name="country" value="" placeholder="Country *" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="border p-md-4 cart-totals ml-30">
                        <div class="table-responsive">
                            <div>
                                <div class="d-flex justify-content-between mb-2">
                                    <p class="fw-bold">Tax</p>
                                    <p>Ksh 0</p>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <p class="fw-bold">Shipping</p>
                                    <p>Ksh 0</p>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <p class="fw-bold">Discount</p>
                                    <p>Ksh 0</p>
                                </div>
                                
                                <div class="d-flex justify-content-between mb-2">
                                    <p class="fw-bold">Total</p>
                                    <p>Ksh {{cart_total_amount|floatformat:0|intcomma}}</p>
                                </div>
                            </div>
                        </div>
                        {% if totalcartitems %}
                            <button type="submit" class="btn mb-20 w-100">Proceed To CheckOut<i class="fi-rs-sign-out ml-15"></i></button>
                        {% endif %}                    
                    </div>
                </div>
            </div>
        </form>
	</div>
</main>

<!-- Add CSS for variation display -->
<style>
.variation-details {
    background: #f8f9fa;
    padding: 8px 12px;
    border-radius: 6px;
    border-left: 3px solid #3BB77E;
}

.product-thumbnail img {
    transition: transform 0.3s ease;
}

.product-thumbnail img:hover {
    transform: scale(1.05);
}

.input-group .form-control {
    border-color: #ddd;
}

.input-group .btn-outline-secondary {
    border-color: #ddd;
    color: #666;
}

.input-group .btn-outline-secondary:hover {
    background-color: #3BB77E;
    border-color: #3BB77E;
    color: white;
}

.table-wishlist tbody tr {
    border-bottom: 1px solid #eee;
}

.table-wishlist tbody tr:hover {
    background-color: #f9f9f9;
}
</style>

{% endblock content %}