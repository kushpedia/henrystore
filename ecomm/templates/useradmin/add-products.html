{% extends 'useradmin/base.html' %}
{% load static %}
{% load humanize %}
{{ form.media }}
{% block content %}   
<head>
    <style>
        select {
        appearance: none;
        outline: 0;
        background: rgba(240, 240, 240, 0.548);
        background-image: none;
        width: 100%;
        height: 700px;
        color: black;
        cursor: pointer;
        border: none;
        border-radius: 3px;
    }
    #id_category {
        position: relative;
        display: block;
        width: 15em;
        font-family: poppins;
        border: none;
        height: 3em;
        line-height: 3;
        overflow: hidden;
        border-radius: .25em;
        padding-bottom: 10px;
    }
    </style>
</head>
            <section class="content-main">
                <form method="POST" enctype="multipart/form-data">
					{% csrf_token %}

                <div class="row">
                    <div class="col-9">
                        <div class="content-header">
                            <h2 class="content-title">Add New Product</h2>
                            <div>
                                <button class="btn btn-md rounded font-sm hover-up">Publish <i class="fas fa-check-circle ms-2"></i></button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Basic</h4>
                            </div>
                            <div class="card-body">
                                
                                {% if form.errors %}
                                    
                                
                                <div class="alert alert-danger">
                                    <strong>{{ form.errors }}</strong>
                                </div>
                                {% endif %}
                                    
                                    <div class="mb-4">
                                        <label for="product_name" class="form-label">Product title</label>
                                        {{form.title}}
                                        
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label">Full description</label>
                                        {{form.description}}

                                        
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="mb-4">
                                                <label class="form-label">Selling price</label>
                                                <div class="row gx-2">
                                        {{form.price}}

                                                    <!-- <input placeholder="$" type="text" class="form-control" /> -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="mb-4">
                                                <label class="form-label">Old price</label>
                                        {{form.old_price}}

                                                <!-- <input placeholder="$" type="text" class="form-control" /> -->
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <label class="form-label">Currency</label>
                                            <select class="form-select">
                                                <option>KES</option>
                                            
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label">Type</label>
                                        {{form.type}}
                                        <!-- <input type="text" placeholder="%" class="form-control" id="product_name" /> -->
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label">Stock</label>
                                        {{form.stock_count}}
                                        <!-- <input type="text" placeholder="%" class="form-control" id="product_name" /> -->
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">Life of Product</label>
                                        {{form.life}}
                                        <!-- <input type="text" placeholder="%" class="form-control" id="product_name" /> -->
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">Manufactured Date</label>
                                        {{form.mfd}}
                                        <!-- <input type="text" placeholder="%" class="form-control" id="product_name" /> -->
                                    </div>

                                    

                                    <div class="mb-4">
                                        <label class="form-label">Digital Product</label>
                                        <br>
                                        {{form.digital}}
                                        <small class="text-muted ms-2">Check if only this is a digital product</small>
                                    </div>
                            </div>
                        </div>
						<!-- card end// -->
                    </div>
                    <div class="col-lg-3">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Media</h4>
                            </div>
                            <div class="card-body">
                                <div class="input-upload">
                                    <img src="{% static 'assets2/imgs/theme/upload.svg' %}" alt="" />
                                    <!-- <input class="form-control" type="file" /> -->
                                    {{form.image}}
                                </div>
                            </div>
                        </div>
                        <!-- card end// -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Others</h4>
                            </div>
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Category</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row gx-2">
                                        <div class="col-sm-12 mb-3">
                                            <label class="form-label">Product Category</label>
                                            {{form.mini_subcategory}}
                                            <small class="text-muted">Format: Main Category > Subcategory > Mini Subcategory</small>
                                            {% if form.mini_subcategory.errors %}
                                                <div class="text-danger">
                                                    {% for error in form.mini_subcategory.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                                <!-- row.// -->
                            </div>
                            <br>
                            
                        </div>
                        <!-- card end// -->
                        <button class="btn mt-3 btn-md rounded font-sm hover-up" type="submit">Create Product</button>
                    </div>
                </div>
                </form>
            </section>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // When category changes, load subcategories
    $('#id_category').change(function() {
        var categoryId = $(this).val();
        if (categoryId) {
            $.ajax({
                url: '/useradmin/get-subcategories/',  // You need to create this URL
                data: {
                    'category_id': categoryId
                },
                success: function(data) {
                    $('#id_subcategory').html('<option value="">Select Subcategory</option>');
                    $.each(data, function(key, value) {
                        $('#id_subcategory').append('<option value="' + key + '">' + value + '</option>');
                    });
                    $('#id_mini_subcategory').html('<option value="">Select Mini Subcategory</option>');
                }
            });
        } else {
            $('#id_subcategory').html('<option value="">Select Category First</option>');
            $('#id_mini_subcategory').html('<option value="">Select Subcategory First</option>');
        }
    });

    // When subcategory changes, load mini subcategories
    $('#id_subcategory').change(function() {
        var subcategoryId = $(this).val();
        if (subcategoryId) {
            $.ajax({
                url: '/useradmin/get-mini-subcategories/',  // You need to create this URL
                data: {
                    'subcategory_id': subcategoryId
                },
                success: function(data) {
                    $('#id_mini_subcategory').html('<option value="">Select Mini Subcategory</option>');
                    $.each(data, function(key, value) {
                        $('#id_mini_subcategory').append('<option value="' + key + '">' + value + '</option>');
                    });
                }
            });
        } else {
            $('#id_mini_subcategory').html('<option value="">Select Subcategory First</option>');
        }
    });
});
</script>
            {% endblock content %}
